<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Series - Violence Alley</title>
<link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.3/dist/tailwind.min.css" rel="stylesheet">
<style>
body {
  font-family: "Courier New", monospace;
  background: linear-gradient(135deg, #0b0b0b, #1a1a1a);
}
.neon-text {
  text-shadow: 0 0 5px #ff0000, 0 0 10px #ff0066, 0 0 20px #ff00cc;
}
.episode-card {
  transition: transform 0.2s, box-shadow 0.2s;
  background: #111;
}
.episode-card:hover {
  transform: scale(1.03);
  box-shadow: 0 0 20px #ff0044, 0 0 40px #ff00aa;
}
button {
  transition: background 0.2s;
}
#video-player {
  width: 100%;
  max-width: 800px;
  margin: 20px auto;
  border: 4px solid #ff0055;
  border-radius: 8px;
}
</style>
</head>
<body class="text-red-500 p-6 min-h-screen">

<div id="content" class="max-w-5xl mx-auto"></div>

<div id="video-player" class="hidden">
  <video id="player" controls class="w-full rounded">
    <source id="video-source" src="" type="video/mp4">
    Your browser does not support HTML5 video.
  </video>
</div>

<footer class="text-center mt-12">
  <a href="index.html" class="text-cyan-400 underline">Back to Home</a>
</footer>

<script src="js/shows.js"></script>
<script>
const urlParams = new URLSearchParams(window.location.search);
const id = urlParams.get('id');
const showInfo = showList.find(s => s.tmdb.toString() === id);
const content = document.getElementById("content");
const videoPlayer = document.getElementById("video-player");
const player = document.getElementById("player");
const videoSource = document.getElementById("video-source");

if (!showInfo) {
  content.innerHTML = "<p class='text-center text-red-500'>Show not found.</p>";
} else {

  async function fetchShow(tmdbId) {
    const res = await fetch(`/api/tmdb?type=tv&id=${tmdbId}`);
    return res.json();
  }

  async function fetchSeason(tmdbId, seasonNum) {
    const res = await fetch(`/api/tmdb?type=season&id=${tmdbId}&season=${seasonNum}`);
    return res.json();
  }

  (async () => {
    const showData = await fetchShow(id);

    content.innerHTML = `
      <header class="text-center mb-8">
        <h1 class="text-5xl font-bold mb-2 text-red-500 neon-text">${showData.name}</h1>
        <p class="text-cyan-400 max-w-3xl mx-auto">${showData.overview}</p>
      </header>
    `;

    const episodesContainer = document.createElement("div");
    episodesContainer.className = "space-y-6";
    content.appendChild(episodesContainer);

    for (const season of showData.seasons) {
      if (!season.season_number) continue;
      const seasonData = await fetchSeason(id, season.season_number);

      const seasonDiv = document.createElement("div");
      seasonDiv.className = "mb-8";
      seasonDiv.innerHTML = `<h2 class="text-3xl text-pink-500 mb-4">Season ${season.season_number}</h2>`;
      episodesContainer.appendChild(seasonDiv);

      const epGrid = document.createElement("div");
      epGrid.className = "grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6";
      seasonDiv.appendChild(epGrid);

      seasonData.episodes.forEach(ep => {
        const epCard = document.createElement("div");
        epCard.className = "episode-card p-3 rounded-lg border border-pink-600 hover:border-red-500";

        const epThumbnail = ep.still_path ? `https://image.tmdb.org/t/p/w300${ep.still_path}` : 'https://via.placeholder.com/300x170?text=No+Image';

        epCard.innerHTML = `
          <img src="${epThumbnail}" alt="${ep.name}" class="w-full rounded mb-2">
          <h3 class="text-xl font-bold text-red-500 mb-1">${ep.name}</h3>
          <p class="text-gray-300 text-sm mb-2">${ep.overview ? ep.overview.substring(0,120) + "..." : "No description available."}</p>
          <button class="bg-red-500 hover:bg-pink-600 text-white font-bold py-2 px-4 rounded w-full">Watch</button>
        `;

        epCard.querySelector("button").addEventListener("click", () => {
          // Update player to show episode inline
          const url = `https://vidfast.pro/tv/${showInfo.imdb}/${season.season_number}/${ep.episode_number}?autoPlay=true&autoNext=true`;
          videoSource.src = url;
          player.load();
          videoPlayer.classList.remove("hidden");
          window.scrollTo({ top: videoPlayer.offsetTop - 20, behavior: "smooth" });
        });

        epGrid.appendChild(epCard);
      });
    }
  })();
}
</script>
</body>
</html>
