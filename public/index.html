<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Violence Alley - Adult Swim Archive</title>
<link href="css/style.css" rel="stylesheet">
</head>
<body>

<!-- Navigation -->
<nav class="navbar">
  <div class="navbar-container">
    <a href="index.html" class="navbar-logo">Violence Alley</a>
    <ul class="navbar-links" id="navbar-links">
      <li><a href="index.html" class="active">Home</a></li>
      <li><a href="#series">Series</a></li>
      <li><a href="request.html">Requests</a></li>
    </ul>
    <div class="navbar-actions">
      <a href="request.html" class="btn-primary">Submit Request</a>
    </div>
    <button class="mobile-menu-toggle" aria-controls="navbar-links" aria-expanded="false" aria-label="Toggle navigation">☰</button>
  </div>
</nav>

<!-- Hero Section -->
<div class="container">
  <section class="hero">
    <h1 class="hero-title">Violence Alley</h1>
    <p class="hero-subtitle">Your retro Adult Swim streaming archive</p>
    
    <div class="search-container">
      <input 
        id="search" 
        type="text" 
        class="search-input" 
        placeholder="Search for series..."
      >
    </div>
  </section>

  <!-- Series Grid -->
  <section class="section" id="series">
    <h2 class="section-title">Browse Series</h2>
    <div id="show-list" class="grid">
      <p id="loading-message" class="loading">Loading series...</p>
    </div>
  </section>
</div>

<!-- Footer -->
<footer class="footer">
  <div class="container">
    <p><a href="request.html">Request a Series</a></p>
    <p class="footer-copyright">© 2025 Violence Alley</p>
  </div>
</footer>

<script>
// Mobile Menu Toggle with Accessibility
document.addEventListener('DOMContentLoaded', function() {
  const mobileToggle = document.querySelector('.mobile-menu-toggle');
  const navLinks = document.querySelector('.navbar-links');
  
  if (mobileToggle && navLinks) {
    mobileToggle.addEventListener('click', function() {
      const isExpanded = navLinks.classList.toggle('mobile-active');
      mobileToggle.setAttribute('aria-expanded', isExpanded);
    });
    
    // Close on Escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && navLinks.classList.contains('mobile-active')) {
        navLinks.classList.remove('mobile-active');
        mobileToggle.setAttribute('aria-expanded', 'false');
      }
    });
  }
});
</script>

<script src="js/shows.js"></script>
<script>
async function fetchShow(tmdbId) {
  const res = await fetch(`/api/tmdb?type=tv&id=${tmdbId}`);
  if (!res.ok) return null;
  return res.json();
}

const showContainer = document.getElementById("show-list");
const searchInput = document.getElementById("search");
const loadingMessage = document.getElementById("loading-message");

async function renderShows(filter = "") {
  showContainer.innerHTML = "";
  
  if (loadingMessage) {
    loadingMessage.textContent = "Loading series...";
    showContainer.appendChild(loadingMessage);
  }

  const fetchPromises = showList.map(show => fetchShow(show.tmdb));
  const allShowData = await Promise.all(fetchPromises);

  if (loadingMessage) loadingMessage.remove();
  
  const filteredData = [];

  for (let i = 0; i < showList.length; i++) {
    const show = showList[i];
    const data = allShowData[i];

    if (!data || !data.name || !data.name.toLowerCase().includes(filter.toLowerCase())) continue;
    
    filteredData.push({ show, data });
  }

  if (filteredData.length === 0) {
    showContainer.innerHTML = `<p class="loading">No series found matching "${filter}"</p>`;
    return;
  }

  filteredData.forEach(({ show, data }) => {
    const card = document.createElement("div");
    card.className = "card";
    
    const posterUrl = data.poster_path 
      ? `https://image.tmdb.org/t/p/w500${data.poster_path}` 
      : 'https://via.placeholder.com/500x750?text=No+Poster';
    
    const year = data.first_air_date ? new Date(data.first_air_date).getFullYear() : '';
    const seasons = data.number_of_seasons ? `${data.number_of_seasons} Season${data.number_of_seasons > 1 ? 's' : ''}` : '';
    
    card.innerHTML = `
      <a href="series.html?id=${show.tmdb}">
        <div class="card-image-wrapper card-poster">
          <img src="${posterUrl}" alt="${data.name}" class="card-image" loading="lazy">
        </div>
        <div class="card-content">
          <h3 class="card-title">${data.name}</h3>
          <p class="card-description">${data.overview || "No description available."}</p>
          <div class="card-meta">
            ${year ? `<span>${year}</span>` : ''}
            ${seasons ? `<span>•</span><span>${seasons}</span>` : ''}
          </div>
        </div>
      </a>
    `;
    
    showContainer.appendChild(card);
  });
}

renderShows();

searchInput.addEventListener("input", e => {
  if (window.searchTimer) clearTimeout(window.searchTimer);
  window.searchTimer = setTimeout(() => {
    renderShows(e.target.value);
  }, 300);
});
</script>
</body>
</html>
